FLAG: arn:aws:s3:::orion-games/logos/10/3913/*
self.logos_path = signed_url.partition("/")[2]
logos/10/3913/*

FLAG: arn:aws:s3:::orion-games/logos/10/3913/*
Logos Origem: orion-games Objeto: logos/10/*

GAME_ROOT_FOLDER = '/data'
SYNC_LOGOS_FOLDER = f'{GAME_ROOT_FOLDER}/logos-sync'

def get_logos_path(self):
        return SYNC_LOGOS_FOLDER

logger.info(f'signed_url: {signed_url}')
signed_url: arn:aws:s3:::orion-games/logos/10/3913/*
logger.info(f'self.sync_logos_folder: {self.sync_logos_folder}')
self.sync_logos_folder: /data/logos-sync
# self.sync_logos_folder: /data/logos-sync
logger.info(f'self.logos_path: {self.logos_path}')
self.logos_path: logos/10/*
# self.logos_path: logos/10/3913/*
logger.info(f'self.LOGOS_FOLDER: {self.LOGOS_FOLDER}')
self.LOGOS_FOLDER: /data/games/logos
# self.LOGOS_FOLDER: /data/games/logos
logger.info(f'logos_full_path: {logos_full_path}')
logos_full_path: /data/logos-sync/logos/10/*
logger.info(f'logos_full_path 2: {logos_full_path}')

cmd = ['aws', 's3', 'sync', f's3://{bucket}/', self.sync_logos_folder, '--exclude', '*', '--include', f'{self.logos_path}']

aws s3 ls s3://orion-games/logos/10/3913/ --recursive 
aws s3 sync s3://orion-games /data/logos-sync --exclude "*" --include "logos/10/3913/*" --dryrun --debug
aws s3 sync s3://orion-games /data/logos-sync --exclude "*" --include "logos/10/3913/*" --dryrun
aws s3 sync s3://orion-games /data/logos-sync --exclude "*" --include "logos/10/3913/logo-*" --dryrun
aws s3 sync s3://orion-games /data/logos-sync --exclude "*" --include "logos/10/3913/logo-xbr.png" --dryrun
aws s3 cp s3://orion-games/logos/10/3913/logo-xbr.png /data/logos-sync/ --dryrun

aws s3 sync s3://orion-games /data/logos-sync --exclude "*" --include "logos/10/2276/*" --dryrun
aws s3 sync s3://orion-games/logos/10/2276/* /data/logos-sync/ --delete --dryrun

# check if /data/logos-sync is not empty
        if any(os.scandir(self.AGENT.get_logos_path())):
            # set logos full path
            logos_full_path = f'{self.sync_logos_folder}/{self.logos_path}'
            # removing last character(*) from string
            logos_full_path = logos_full_path[:-1]
            # copy logos to /games/logos
            [shutil.copy(f'{logos_full_path}/{logo}', self.LOGOS_FOLDER) for logo in os.listdir(logos_full_path)]

rc/lfernando - 1.6.14-rc
dev/lfernando - minha vers√£o, n√£o apagar nem fodendo

cd /data/logos-sync
cd /usr/lib/node_modules/@zoeslots/zoe-updater
vim.tiny logos.py
systemctl restart zoe-updater
tailf /var/log/orion-updater.log
ls /data/games/logos
ls /data/logos-sync
rm -r /data/logos-sync/*

preciso de um servidor funcionando pra ver como fica a estrutura do role
n√£o t√° capturando os arquivos? Preciso confirmar isso

cmd = ['aws', 's3', 'sync', f's3://{bucket}/', self.sync_logos_folder, '--exclude', '*', '--include', f'{self.logos_path}']
            
# exe command
process = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
output, err = process.communicate()
output = output.decode() + ' ' + err.decode()

Boa! Vamos esclarecer a diferen√ßa entre **usar ou n√£o o `--include "logos/10/*"`**.  

---

## **1Ô∏è‚É£ Comando sem filtros (pega tudo)**
```bash
aws s3 sync s3://orion-games/logos/10/ /data/logos-sync/
```
üîπ Esse comando **sincroniza tudo** que est√° dentro de `logos/10/`.  
üîπ Ele j√° entende que `logos/10/` √© um diret√≥rio e copia **todos os arquivos e subpastas dentro dele**.  
üîπ Voc√™ **N√ÉO precisa** do `*` no final porque o `sync` j√° assume que quer tudo.  

‚úÖ **O que ele baixa?**  
```
logos/10/file1.png
logos/10/file2.jpg
logos/10/3913/file3.png
logos/10/4001/file4.png
```
Ou seja, **ele traz subdiret√≥rios como `3913/` e `4001/` tamb√©m**.

---

## **2Ô∏è‚É£ Comando com `--exclude` e `--include` (filtra arquivos espec√≠ficos)**
```bash
aws s3 sync s3://orion-games/ /data/logos-sync/ --exclude "*" --include "logos/10/*"
```
üîπ Aqui, o `--exclude "*"` diz para **ignorar tudo** por padr√£o.  
üîπ O `--include "logos/10/*"` **permite apenas os arquivos diretamente dentro de `logos/10/`**.  
üîπ Como resultado, **ele N√ÉO baixa subpastas dentro de `logos/10/`**.

‚úÖ **O que ele baixa?**  
```
logos/10/file1.png
logos/10/file2.jpg
```
‚ùå **O que ele N√ÉO baixa?**  
```
logos/10/3913/file3.png  (Ignorado)
logos/10/4001/file4.png  (Ignorado)
```
Ou seja, **ele s√≥ pega os arquivos dentro de `logos/10/`, mas N√ÉO suas subpastas**.

---

## **üéØ Resumo**
| Comando | O que ele faz? |
|---------|--------------|
| `aws s3 sync s3://orion-games/logos/10/ /data/logos-sync/` | Baixa **tudo** dentro de `logos/10/`, incluindo subdiret√≥rios. |
| `aws s3 sync s3://orion-games/ /data/logos-sync/ --exclude "*" --include "logos/10/*"` | Baixa **somente arquivos diretos** dentro de `logos/10/`, sem subpastas. |

Se voc√™ **quer tudo (arquivos e subpastas), use apenas o primeiro comando**.  
Se voc√™ **quer s√≥ os arquivos diretos dentro do diret√≥rio, sem subpastas, use `--include "logos/10/*"`**. üöÄ

---
---

## üìå **`aws s3 sync`: Como funciona?**  

O comando `aws s3 sync` sincroniza arquivos entre **duas localidades**, que podem ser:  
‚úÖ Um **bucket S3** ‚Üí um diret√≥rio local  
‚úÖ Um **diret√≥rio local** ‚Üí um bucket S3  
‚úÖ Um **bucket S3** ‚Üí outro bucket S3  

Ele **s√≥ copia arquivos que mudaram** desde a √∫ltima sincroniza√ß√£o, tornando-o eficiente.  
Se um arquivo j√° existe no destino com o mesmo conte√∫do, ele **n√£o ser√° copiado novamente**.  

---

## üõ†Ô∏è **Sintaxe b√°sica**  

```sh
aws s3 sync <origem> <destino> [op√ß√µes]
```

### üîπ **Exemplo 1: Baixar arquivos do S3 para um diret√≥rio local**
```sh
aws s3 sync s3://meu-bucket/meus-arquivos /data/meus-arquivos
```

### üîπ **Exemplo 2: Enviar arquivos locais para o S3**
```sh
aws s3 sync /data/meus-arquivos s3://meu-bucket/meus-arquivos
```

---

## üîç **Como o `sync` funciona internamente**
O `sync` percorre **todos os arquivos na origem e no destino**, comparando:
1. **Nome do arquivo**
2. **Tamanho**
3. **√öltima modifica√ß√£o**

üìå **Se um arquivo na origem √© diferente do destino, ele ser√° copiado.**  
üìå **Se um arquivo existe no destino, mas n√£o na origem, ele ser√° ignorado (a menos que voc√™ use `--delete`).**  

---

## ‚öôÔ∏è **Principais Flags do `aws s3 sync`**
| Flag | O que faz? | Exemplo |
|------|-----------|---------|
| `--exclude "<padr√£o>"` | **Exclui arquivos** da sincroniza√ß√£o | `--exclude "*.tmp"` |
| `--include "<padr√£o>"` | **Inclui arquivos** espec√≠ficos que foram exclu√≠dos por `--exclude` | `--exclude "*" --include "*.png"` |
| `--delete` | **Remove arquivos do destino** que n√£o existem na origem | `--delete` |
| `--exact-timestamps` | **Mant√©m a data/hora original** dos arquivos | `--exact-timestamps` |
| `--dryrun` | **Simula a sincroniza√ß√£o**, sem modificar arquivos | `--dryrun` |
| `--recursive` | **(Padr√£o)** Processa arquivos e subdiret√≥rios | `--recursive` |

---

## üö® **Por que o `sync` pode n√£o funcionar no seu caso?**
Se o `aws s3 cp` e o `aws s3 ls` funcionam, mas o `aws s3 sync` **n√£o**, pode haver um problema com os filtros. Veja os principais motivos:

### ‚ùå 1. `--exclude "*"` est√° removendo tudo antes do `--include`
üõ† **Solu√ß√£o**: Teste sem `--exclude "*"`, apenas com `--include` para ver se ele encontra os arquivos.

```sh
aws s3 sync s3://orion-games /data/logos-sync --include "logos/10/3913/*" --dryrun
```

Se isso funcionar, ent√£o o problema era a exclus√£o.

---

### ‚ùå 2. Caminho do `--include` n√£o corresponde ao bucket
Se o caminho esperado √© `logos/10/3913/logo-xbr.png`, o `--include` precisa come√ßar com `logos/10/3913/`:

```sh
aws s3 sync s3://orion-games /data/logos-sync --exclude "*" --include "logos/10/3913/*" --dryrun
```

üìå **O `sync` compara caminhos completos, e n√£o apenas nomes de arquivos!**

---

### ‚ùå 3. Voc√™ est√° rodando o `sync` na raiz errada do bucket
Se seu bucket tem uma estrutura assim:
```
orion-games/
‚îú‚îÄ‚îÄ assets/
‚îú‚îÄ‚îÄ logos/
‚îÇ   ‚îú‚îÄ‚îÄ 10/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3913/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logo-xbr.png
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logo-xur.png
```

üìå Ent√£o `aws s3 sync s3://orion-games /data/logos-sync --include "logos/10/3913/*"` **deve funcionar**.

Mas se voc√™ rodar o comando assim:

```sh
aws s3 sync s3://orion-games/logos/10/3913 /data/logos-sync --include "*"
```
Ele n√£o funciona porque `s3://orion-games/logos/10/3913/` n√£o √© um bucket, mas sim uma pasta **dentro** do bucket.

‚úÖ **Corre√ß√£o**:
```sh
aws s3 sync s3://orion-games /data/logos-sync --include "logos/10/3913/*"
```

---

## ‚úÖ **Teste com Debug para entender o problema**
Se ainda n√£o estiver funcionando, rode o `sync` com `--debug` para ver o que acontece:

```sh
aws s3 sync s3://orion-games /data/logos-sync --exclude "*" --include "logos/10/3913/*" --dryrun --debug
```

Isso mostrar√° exatamente **quais arquivos foram encontrados e quais foram ignorados**.

---

## **üìå Conclus√£o**
1Ô∏è‚É£ **O `sync` s√≥ copia arquivos diferentes entre origem e destino.**  
2Ô∏è‚É£ **O `--exclude "*"` pode bloquear tudo antes que `--include` seja aplicado.**  
3Ô∏è‚É£ **O `--include` precisa corresponder exatamente ao caminho no S3.**  
4Ô∏è‚É£ **Se `aws s3 ls` funciona, `sync` tamb√©m deveria funcionar com os mesmos caminhos.**  
5Ô∏è‚É£ **Use `--debug` para entender por que os arquivos n√£o est√£o sendo sincronizados.**  

üîπ **Tente os passos acima e me diga o que acontece!** üöÄ

---
---

O `--exclude` **n√£o deleta nada no S3 ou localmente**. Ele apenas **filtra quais arquivos ser√£o considerados na sincroniza√ß√£o**.  

Ou seja:  
- **Ele n√£o remove arquivos existentes no destino.**  
- **Ele apenas impede que certos arquivos sejam copiados ou atualizados.**  

---

## üõ† **Teste r√°pido para entender**
Imagine que j√° existe esta estrutura no destino (`/data/sync`):  
```
/data/sync/
‚îú‚îÄ‚îÄ imagens/
‚îÇ   ‚îú‚îÄ‚îÄ foto1.jpg
‚îÇ   ‚îú‚îÄ‚îÄ foto2.png
‚îÇ   ‚îú‚îÄ‚îÄ foto3.gif
‚îÇ   ‚îú‚îÄ‚îÄ teste.txt
```
Agora rodamos:  
```sh
aws s3 sync s3://meu-bucket /data/sync --exclude "*" --include "*.png"
```
üìå **O que acontece?**  
‚úÖ **Apenas arquivos `.png` do S3 ser√£o sincronizados.**  
‚ùå **Mas ele N√ÉO vai deletar `foto1.jpg`, `foto3.gif`, `teste.txt` do `/data/sync`.**  

Se no S3 houver **`foto2.png` mais atualizada**, ele **atualiza a c√≥pia local**.  
Se `foto2.png` **n√£o existir no destino**, ele **baixa**.  

üìå **O que ele N√ÉO faz?**  
‚ùå Ele **n√£o remove os outros arquivos j√° existentes no destino**.  

---

## üö® **E se eu quiser apagar arquivos do destino?**
Se voc√™ quer que o destino **fique id√™ntico ao S3**, pode usar `--delete`:  
```sh
aws s3 sync s3://meu-bucket /data/sync --delete
```
‚úÖ Isso **sincroniza normalmente**.  
‚ùå E **remove do destino qualquer arquivo que n√£o esteja mais no S3**.  

Se quiser combinar `--exclude` com `--delete`:  
```sh
aws s3 sync s3://meu-bucket /data/sync --exclude "*" --include "*.png" --delete
```
üìå Isso:  
‚úÖ **Baixa apenas arquivos `.png` do S3**  
‚ùå **Apaga do destino qualquer arquivo que n√£o esteja no S3**  

---

## ‚úÖ **Resumo final**
- `--exclude` **s√≥ filtra** quais arquivos ser√£o sincronizados.  
- Ele **N√ÉO deleta arquivos do destino automaticamente**.  
- Para deletar arquivos no destino que n√£o existem mais no S3, use `--delete`.  

üöÄ **Agora ficou claro?**

---
---

ent√£o ele s√≥ desconsidera os arquivos no momento da sincroniza√ß√£o. Ex

s3:

- arq1.txt
- arq2.txt
- arq3.png
- arq4.png

local:

- arq1.txt
- arq2.txt
- arq3.png

e eu usar o comando sync com exclude * e include *.png

ele n√£o vai atualizar o arq1.txt e o arq2.txt, mas criara o arq4.png no local assim como atualiza o arq3.png?
- arq3.png

**Exatamente!** üéØ  

Se voc√™ rodar:  
```sh
aws s3 sync s3://meu-bucket /data/sync --exclude "*" --include "*.png"
```
üìå **O que acontece?**  
‚úÖ **`arq3.png` ser√° atualizado se estiver diferente** (caso tenha sido modificado no S3).  
‚úÖ **`arq4.png` ser√° baixado** para o local, pois n√£o existia.  
‚ùå **`arq1.txt` e `arq2.txt` ser√£o ignorados** e **n√£o ser√£o atualizados**.  

üìù **Resultado final (local ap√≥s o sync)**:  
```
/data/sync/
- arq1.txt  (inalterado)
- arq2.txt  (inalterado)
- arq3.png  (atualizado, se necess√°rio)
- arq4.png  (novo, baixado do S3)
```
üìå **Mas o `arq1.txt` e `arq2.txt` continuam l√°!** üöÄ

---
---

e no caso, se os arquivos logo1.png e logo2.png forem diferentes do que estavam na m√°quina, eles ser√£o atualizados, correto?

Sim, se os arquivos **`logo1.png`** e **`logo2.png`** na S3 forem diferentes dos arquivos locais, eles **ser√£o atualizados** na m√°quina local.  

O `aws s3 sync` verifica **nome, tamanho e data de modifica√ß√£o** para decidir se um arquivo precisa ser atualizado.  

### **O que acontece com os arquivos locais?**
| Arquivo na S3       | Arquivo local        | O que acontece? |
|----------------------|---------------------|-----------------|
| `logo1.png` (atualizado) | `logo1.png` (antigo) | ‚úÖ **Arquivo ser√° atualizado** |
| `logo2.png` (novo)  | `logo2.png` (antigo) | ‚úÖ **Arquivo ser√° atualizado** |
| `logo3.png` (n√£o existe) | `logo3.png` (existe) | ‚ùå **Arquivo ser√° exclu√≠do (com `--delete`)** |

### **Comando final para sincronizar e excluir arquivos extras localmente:**
```sh
aws s3 sync s3://meu-bucket/logos/ /data/logos-sync/ --delete
```
**Resumo:**  
- **Arquivos que est√£o na S3 e n√£o est√£o na m√°quina** ‚Üí **Ser√£o baixados**  
- **Arquivos que est√£o na m√°quina e n√£o est√£o na S3** ‚Üí **Ser√£o exclu√≠dos** (por causa do `--delete`)  
- **Arquivos que existem em ambos, mas s√£o diferentes** ‚Üí **Ser√£o atualizados**  

Se quiser filtrar apenas **arquivos PNG**, use:  
```sh
aws s3 sync s3://meu-bucket/logos/ /data/logos-sync/ --exclude "*" --include "*.png" --delete
```

---
---

FLAG: arn:aws:s3:::orion-games/logos/10/3913/*
self.logos_path = signed_url.partition("/")[2]
logos/10/3913/*

FLAG: arn:aws:s3:::orion-games/logos/10/3913/*
Logos Origem: orion-games Objeto: logos/10/*

ERROR  : Logos error [Errno 21] Is a directory: '/data/logos-sync/logos/10//2454'                                                                                                                                           
Traceback (most recent call last):                                                                                                                                                                                                              
  File "/usr/lib/node_modules/@zoeslots/zoe-updater/logos.py", line 37, in run                                                                                                                                                                  
    self._check()                                                                                                                                                                                                                               
  File "/usr/lib/node_modules/@zoeslots/zoe-updater/logos.py", line 63, in _check                                                                                                                                                               
    self._copyToGames()                                                                                                                                                                                                                         
  File "/usr/lib/node_modules/@zoeslots/zoe-updater/logos.py", line 102, in _copyToGames                                                                                                                                                        
    [shutil.copy(f'{logos_full_path}/{logo}', self.LOGOS_FOLDER) for logo in os.listdir(logos_full_path)]                                                                                                                                       
  File "/usr/lib/node_modules/@zoeslots/zoe-updater/logos.py", line 102, in <listcomp>                                                                                                                                                          
    [shutil.copy(f'{logos_full_path}/{logo}', self.LOGOS_FOLDER) for logo in os.listdir(logos_full_path)]                                                                                                                                       
  File "/usr/lib/python3.6/shutil.py", line 245, in copy                                                                                                                                                                                        
    copyfile(src, dst, follow_symlinks=follow_symlinks)                                                                                                                                                                                         
  File "/usr/lib/python3.6/shutil.py", line 120, in copyfile                                                                                                                                                                                    
    with open(src, 'rb') as fsrc:                                                                                                                                                                                                               
IsADirectoryError: [Errno 21] Is a directory: '/data/logos-sync/logos/10//2454'