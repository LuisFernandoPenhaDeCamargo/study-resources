agent.py

def _sync_AWS(self):
        self.STATE['games'] = Current.SYNCING
        request = API.get_policies()
        
        for games in request["games_allowed"]:

            bucket = games.partition("/")[0].partition(":::")[2]
            game_path = games.partition("/")[2]
            
            logger.info(f'Origem: {bucket} Objeto: {game_path}')
            cmd = ['aws', 's3', 'sync', f's3://{bucket}/', SYNC_GAMES_FOLDER, '--exclude', '*', '--include', f'{game_path}']

            process = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
            output, err = process.communicate()
            output = output.decode() + ' ' + err.decode()

---

def _sync_AWS(self):
        self.STATE['games'] = Current.SYNCING
        request = API.get_games_allowed()

        for games in request["games_allowed"]:

            game = games.split('/')
            game_len = len(game)
            folder = game[1]
            game_name = ''

            if game_len == 3:
                game_name = f'/{game[2]}'
            
            bucket = game[0].split(':::')

            cmd = ['aws', 's3', 'sync', f's3://{bucket[1]}/', SYNC_GAMES_FOLDER, '--exclude', '*', '--include', f'{folder}{game_name}']
            logger.info(f'Origem: {bucket} Objeto: {folder}{game_name}')

            process = subprocess.Popen(
                cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
            output, err = process.communicate()
            output = output.decode() + ' ' + err.decode()

api.py
def get_policies(self) -> def get_games_allowed(self)
database.py
Tem alterações minhas
logos.py
Comparar a master e a 1.6.14-rc
self_updater.py
Tem alterações minhas
services.py
Tem alterações minhas

---

response: {'status': 'OK', 'games_allowed': ['arn:aws:s3:::orion-games/version', 'arn:aws:s3:::orion-games/finish-update.sh', 'arn:aws:s3:::orion-games/finish-update-mexico.sh', 'arn:aws:s3:::orion-games/pt/lobby.tar', 'arn:aws:s3:::orion-games/pt/lobby-mexico.tar', 'arn:aws:s3:::orion-games/pt/version', 'arn:aws:s3:::orion-games/utils/*', 'arn:aws:s3:::orion-games/pt/network-setup.tar', 'arn:aws:s3:::orion-games/pt/alpha-dragon-w000.tar', 'arn:aws:s3:::orion-games/pt/alpha-buffalo-w000.tar', 'arn:aws:s3:::orion-games/pt/lion.tar', 'arn:aws:s3:::orion-games/pt/alpha-royal-tiger-w000.tar', 'arn:aws:s3:::orion-games/pt/alpha-wacamole-w000.tar', 'arn:aws:s3:::orion-games/pt/alpha-dragon-s000.tar', 'arn:aws:s3:::orion-games/pt/alpha-royal-dragon-w000.tar'], 'logos_allowed': 'arn:aws:s3:::orion-games/logos/10/2276/*', 'videos_allowed': 'arn:aws:s3:::orion-games/videos/10/2276/*'}

signed_url: arn:aws:s3:::orion-games/logos/10/2276/*

request: {'status': 'OK', 'games_allowed': ['arn:aws:s3:::orion-games/version', 'arn:aws:s3:::orion-games/finish-update.sh', 'arn:aws:s3:::orion-games/finish-update-mexico.sh', 'arn:aws:s3:::orion-games/pt/lobby.tar', 'arn:aws:s3:::orion-games/pt/lobby-mexico.tar', 'arn:aws:s3:::orion-games/pt/version', 'arn:aws:s3:::orion-games/utils/*', 'arn:aws:s3:::orion-games/pt/network-setup.tar', 'arn:aws:s3:::orion-games/pt/alpha-dragon-w000.tar', 'arn:aws:s3:::orion-games/pt/alpha-buffalo-w000.tar', 'arn:aws:s3:::orion-games/pt/lion.tar', 'arn:aws:s3:::orion-games/pt/alpha-royal-tiger-w000.tar', 'arn:aws:s3:::orion-games/pt/alpha-wacamole-w000.tar', 'arn:aws:s3:::orion-games/pt/alpha-dragon-s000.tar', 'arn:aws:s3:::orion-games/pt/alpha-royal-dragon-w000.tar'], 'logos_allowed': 'arn:aws:s3:::orion-games/logos/10/2276/*', 'videos_allowed': 'arn:aws:s3:::orion-games/videos/10/2276/*'}

---

request: {'status': 'OK', 'games_allowed': ['arn:aws:s3:::orion-games/version', 'arn:aws:s3:::orion-games/finish-update.sh', 'arn:aws:s3:::orion-games/finish-update-mexico.sh', 'arn:aws:s3:::orion-games/pt/lobby.tar', 'arn:aws:s3:::orion-games/pt/lobby-mexico.tar', 'arn:aws:s3:::orion-games/pt/version', 'arn:aws:s3:::orion-games/utils/*', 'arn:aws:s3:::orion-games/pt/network-setup.tar', 'arn:aws:s3:::orion-games/pt/alpha-dragon-w000.tar', 'arn:aws:s3:::orion-games/pt/alpha-buffalo-w000.tar', 'arn:aws:s3:::orion-games/pt/lion.tar', 'arn:aws:s3:::orion-games/pt/alpha-royal-tiger-w000.tar', 'arn:aws:s3:::orion-games/pt/alpha-wacamole-w000.tar', 'arn:aws:s3:::orion-games/pt/alpha-dragon-s000.tar', 'arn:aws:s3:::orion-games/pt/alpha-royal-dragon-w000.tar'], 'logos_allowed': 'arn:aws:s3:::orion-games/logos/10/2276/*', 'videos_allowed': 'arn:aws:s3:::orion-games/videos/10/2276/*'}

game: ['arn:aws:s3:::orion-games', 'version']

game_len: 2

folder: version

Origem: ['arn:aws:s3', 'orion-games'] Objeto: version

---

zoe-updater
git clone <URL>
mariadb -u root -p<senha> -e 'CREATE DATABASE IF NOT EXISTS zoeslots;'
Obter o dump
mariadb -u root -p<senha> zoeslots < <dump>.sql
mariadb -u root -p<senha> -e "CREATE USER 'orion'@'localhost' IDENTIFIED BY 'Bl4ckBox1337';"
mariadb -u root -p<senha> -e "GRANT ALL PRIVILEGES ON zoeslots.* TO 'orion'@'localhost';" <- Confirmar os privilégios
mariadb -u root -p<senha> -e 'FLUSH PRIVILEGES;' <- É necessário?
Consigo emender as queries?
mkdir ~/data/
mkdir ~/data/games
mkdir ~/data/games-sync
mkdir ~/data/logos-sync
api.py: comentar da linha 49 a linha 54 e adicionar a seguinte linha `token =  fee5d4acdd915f9032b7d6a850f262deedef8532debf24a8cfbb836d3836c52323033d426437df25191a2e6192e330aa41c1a69772575362b7e7201277ae367d`
Caso vocẽ não tenha a zoe-game-api, orion-data-api, caixa (não lembro o nome), watchdog (não lembro o nome) e o zoe-updater instalados globalmente
agent.py: comente a linha 362 e 363

sudo apt install mariadb-server -y
mariadb --version
sudo apt install meld
meld --version

git pull
git clone <URL>
git branch -a
git switch -c <nome_da_branch>
git push -u origin <nome-da-branch>

sudo mariadb -> Não configurei uma senha root
ALTER USER 'root'@'localhost' IDENTIFIED BY '260490Ab!';
FLUSH PRIVILEGES;
mariadb -u root -p<senha> -e '<query>'

.partition x .split

cmd = ['aws', 's3', 'sync', f's3://{bucket}/', self.sync_logos_folder, '--delete', '--exclude', '*', '--include', f'{self.logos_path}']
https://us-east-2.console.aws.amazon.com/s3/buckets/orion-games?region=us-east-2&bucketType=general&prefix=logos%2F10%2F2276%2F&showversions=false&tab=objects
https://manager.gerencia.games/logos/10
https://ts.orionapps.net/#Q9Q39Ux4Demq18Dn4SB3pxNMpwRSTBGL